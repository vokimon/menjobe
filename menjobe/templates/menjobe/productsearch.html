<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]> <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]> <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Menjo BÃ©: Cerca per producte</title>
	<meta name="description" content="">
	<meta name="author" content="GuifiBaix SCCL">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<script src='http://code.jquery.com/jquery-2.1.1.min.js'></script>
</head>
<body>

<select id='productSelect'>
</select>
<ul id='retailersList'>
<ul>

</body>

<script>
$(function () {
	$.ajax({
		type: 'GET',
		datatype: 'json',
		url: '/json/allproducts',
		success: function(data) {
			var html = []
			var firstItemText = (data.length==0)?
				"No hi ha productes disponibles" :
				"Escull un producte";
			html.push(
				'<option disabled selected>'+firstItemText+'</option>\n');
			for (var i=0; i<data.length; i++) {
				var row=data[i];
				html.push(
					'<option value='+row.id+'>'+row.name+'</option>\n');
			}
			$('#productSelect').html(html.join(''));
		},
	});
	$('#productSelect').change(function (ev) {
			var productId = $(this).val();
			$.ajax({
				type: 'GET',
				datatype: 'json',
				url: '/json/productretailers/'+productId,
				success: function(data) {
					console.log(data);
					html=[]
					if (data.length==0)
						html.push(
							"<li>"+"No hi ha punts de venda pel producte"+'</li>');
					for (var i=0; i<data.length; i++) {
						var row=data[i];
						html.push(
							"<li>"+row.name+"</li>\n");
						}
				$('#retailersList').html(html.join(''));
				},
			});
		})
});
</script>
</html>
